@[TOC](智能家居安全概述)

# 关键词

- 知识图谱，cnnd，漏洞发现，nnd

- ZigBee，也称紫蜂，是一种低速短距离传输的无线网上协议

- 身份伪造攻击，例如BIAS：使攻击者盗用先前配对或绑定的设备身份，并在成功进行身份验证后连接到另一个设备(这个操作无需知道之前建立的长期配对密钥)。一旦BIAS攻击成功，攻击者便可以访问或控制另一个蓝牙设备。

  - 蓝牙5.2的三种line key：

  - ```
    combination key
    
    temporary key
    
    initialization key
    ```

  - combination key的作用：

    - ```
      已配对设备再次连接对方时，会使用 link key 鉴权：
      ```

    - ![image-20220923200338521](C:\Users\8208191402\AppData\Roaming\Typora\typora-user-images\image-20220923200338521.png)

    - ```
      2、鉴权通过后，连接双方可以使用 link key 导出用于加密后续通信数据的 encryption key。
      ```

- 污点分析技术（动态分析技术），**`<sources,sinks,sanitizers>`**

  - 污点分析就是分析程序中由污点源引入的数据是否能够不经无害处理，而直接传播到污点汇聚点。

  - `source` ，污点源，代表**直接引入不受信任的数据或者机密数据到系统中**；
  - `sink` ，即污点/汇聚点，代表**直接产生安全敏感操作**(违反数据完整性)或者**泄露隐私数据到外界**(违反数据保密性)；
  - `sanitizer` ，即无害处理，代表**通过数据加密或者移除危害操作等手段**使数据传播不再对软件系统的信息安全产生危害。
  - 将程序是否存在某种漏洞的问题转化为污点信息是否会被 Sink 点上的操作所使用的问题

  - ![image-20220923191840157](C:\Users\8208191402\AppData\Roaming\Typora\typora-user-images\image-20220923191840157.png)

- 固件，承载系统OS和应用程序（FS）的程序

- 符号执行（动态分析方法），使用符号值代替真实执行，在软件测试领域使用。

  - 选择性符号执行可以对程序员感兴趣的部分进行符号执行，其它的部分使用真实值执行，代表工具S2E

- 模糊测试（动态分析方法），向目标系统提供非预期的输入，并监视异常结果，来发现软件漏洞的方法

  - ![image-20220923192401732](C:\Users\8208191402\AppData\Roaming\Typora\typora-user-images\image-20220923192401732.png)

- 固件逆向分析，

  - 硬件拆解，了解构造，从UART/通用异步收发传输器(Universal Asynchronous Receiver/Transmitter)中取出固件（应对无法下载固件的情况）
  - 固件分析，了解执行，了解所使用的文件系统、内核等信息，并从中取出完整的固件
  - 逻辑测试，查找缺陷，包括固件本身使用的通用库的漏洞，或者说IOT设备功能上的漏洞

- RFID，射频识别

- RFID和NFC

  - 1.工作频率：NFC的工作频率为13.56MHz，而RFID的工作频率有低频，高频（13.56MHz）及超高频。
  - 2.工作距离：NFC的工作距离理论上为0~20cm，但是在产品的实现上，由于采用了特殊功率抑制技术，使其工作距离只有0~10cm，从而更好地保证业务的安全性。由于RFID具有不同的频率，其工作距离在几厘米到几十米不等。
  - 3.工作模式：NFC同时支持读写模式和卡模式。而在RFID中，读卡器和非接触卡是独立的两个实体，不能切换。
  - 4.点对点通信：NFC支持P2P模式，RFID不支持P2P模式。
  - 5.应用领域：RFID更多的应用在生产，物流，跟踪和资产管理上，而NFC则工作在门禁，公交卡，手机支付等领域。
  - 6.标准协议：NFC的底层通讯协议兼容高频RFID的底层通信标准，即兼容ISO14443/ISO15693标准。NFC技术还定义了比较完整的上层协议，如LLCP，NDEF和RTD等。

- 去同步化攻击，指的是去破坏一个已经存在的攻击，例如敌手会向一个主机连续发送被篡改的信息，使得主机丢失其原有的工作结构体系，如果时间恰当，敌手会削弱甚至阻止该主机交换信息

- 漏洞挖掘，https://zhuanlan.zhihu.com/p/464889158

- 网络协议与漏洞，https://blog.csdn.net/m0_37268841/article/details/121826737

- ![image-20220923201437456](C:\Users\8208191402\AppData\Roaming\Typora\typora-user-images\image-20220923201437456.png)

- DoS攻击是指恶意的攻击网络协议实现的缺陷或直接通过野蛮手段耗尽被攻击对象的资源，目的是让目标计算机或网络目标系统服务系统停止响应甚至崩溃，无法提供正常的服务或资源访问。而在此攻击中并不包括侵入目标服务器或目标网络设备。

- 去同步攻击：破坏一个已经存在的攻击，例如敌手会向一个主机连续发送被篡改的信息，使得主机丢失其原有的工作结构体系，如果时间恰当，敌手会削弱甚至阻止该主机交换信息。

- MQTT：**MQTT**(**消息队列遥测传输**)是[ISO](https://baike.baidu.com/item/ISO/10400?fromModule=lemma_inlink) 标准(ISO/IEC PRF 20922)下基于[发布](https://baike.baidu.com/item/发布/33814?fromModule=lemma_inlink)/[订阅](https://baike.baidu.com/item/订阅/8724574?fromModule=lemma_inlink)范式的消息协议。它工作在 TCP/IP协议族上，是为[硬件性能](https://baike.baidu.com/item/硬件性能/12730200?fromModule=lemma_inlink)低下的远程设备以及网络状况糟糕的情况下而设计的发布/订阅型消息[协议](https://baike.baidu.com/item/协议/670528?fromModule=lemma_inlink)，为此，它需要一个[消息中间件 ](https://baike.baidu.com/item/消息中间件 /5899771?fromModule=lemma_inlink)。

- CoAP：为受限节点制定相关的REST（Representational State Transfer）形式的[应用层协议](https://baike.baidu.com/item/应用层协议/3668945?fromModule=lemma_inlink)。这就是CoAP。

- RFID：radio frequency identifification，射频识别，⾮接触通信

# 文章总结：智能家居安全综述

- 智能家居发展历史

> 总线技术-部分IP技术-智能控制集中化-全IP技术（终端基于Zigbee,蓝牙，网络采用云）

- 组成部分
  - ![image-20220923202720195](C:\Users\8208191402\AppData\Roaming\Typora\typora-user-images\image-20220923202720195.png)
  - 终端设备（Client Hard），通讯网络（Server Hard）
  - 智能家居平台：移动APP（Client Soft），物联网云（Server Soft）；平台协调不同的终端设备，提供设备联动（trigger-action）功能。设备之间可通过用户预先设置的规则调用。
- 终端设备可以通过直接接入网络，也可以通过智能手机/网关连接云。
- 终端设备
  - 受限设备，计算资源和存储资源有限，安全机制受限
  - 能力设备，有足够的计算资源和存储资源
- 通信网络协议
  - 物理层与链路层，以太网，WiFi，IEEE
  - 网络层，IP，
  - 传输层，TCPUDP
  - 应用层，MQTT（Message Queue Telemetry Transportation），CoAP（Constraint Application Protocal），A（Advanced）MQP，XMPP（Extended Message Presence Protocal）
  - 协议栈：ZigBee，Bluetooth
  - ![image-20220923204128059](C:\Users\8208191402\AppData\Roaming\Typora\typora-user-images\image-20220923204128059.png)

# 平台安全

![image-20220923204252176](C:\Users\8208191402\AppData\Roaming\Typora\typora-user-images\image-20220923204252176.png)

# 平台安全

## 用户身份验证

> 防止非法用户接入智能设备

离谱的例子

![image-20220923204436897](C:\Users\8208191402\AppData\Roaming\Typora\typora-user-images\image-20220923204436897.png)

- 目前的解决方案

![image-20220923204531189](C:\Users\8208191402\AppData\Roaming\Typora\typora-user-images\image-20220923204531189.png)

## 设备访问控制

> 因为现在大部分是模仿手机的权限控制功能，粒度过大，导致过度授权。

- 方案A，设置基于设备功能的，更细的粒度
- 方案B，按风险相似度分组，给组授权
- 方案C，从设备的自然语言，程序，注释中提取安全相关信息，生成对应的授权用户接口。
- 方案D，带上下文提示的访问控制（过于专业不适用）
- 方案E，使用标签标识数据流，限制敏感信息流出

## 设备联动安全

> 根据用户预先定义的一组规则进行设备联动。

- 智能平台设计缺陷

> 很多是通过智能家居控制平台实现的，这些平台都有直接接入用户信息和物理设备的权限。
>
> hacker->device/plantform->userInfo

> 解决：去中心化联动平台，无法通过一个中心节点的令牌获得整个网络的接入权。

- 用户自己设定的规则缺陷
  - 安全风险
  - 被用于分发病毒和拒绝服务攻击
- 设计能自动生成联动规则的程序

## 智能音箱安全

### 概述

> 智能音箱其实指的是设备中，具有对多个其它设备进行控制的设备。

> 和移动APP具有等共同的控制地位。

### 攻击方式

- 构造恶意语音样本，攻击系统
- 攻击智能音箱控制系统的漏洞
  - 使用超声波指令攻击音箱的语音识别系统，**用户无法听见（1）**，但距离近
  - 提取语音信息的语音特征，生成机器可以识别，**用户无法理解（2）**的噪声/将恶意指令混入歌曲
  - 通过恶意命令，劫持用户的命令，从而窃取用户的谈话数据。

# 设备安全

## 设备漏洞挖掘

![image-20220925204935327](C:\Users\8208191402\AppData\Roaming\Typora\typora-user-images\image-20220925204935327.png)

设备本身被篡改可以用于窃听用户数据或攻击用户（光敏性癫痫）

- 检测方式

  - 扫描二进制固件，缺点是不能自动化提取固件信息。
  - 对固件的信息流，进行安全属性分析。
  - 使用USB领域的知识，来代替无约束的符号执行。
  - 挖掘内存破坏漏洞的启发式算法
  - 从APP端生成畸形数据，从移动端进行模糊测试，避免了固件获取和分析困难的问题。

- 单一设备主要方法总结

  - 固件逆向分析
  - 通信协议分析（流量）
  - 模糊测试（测试）

- 系统挖掘固件漏洞

  > 模糊测试+污点分析技术+符号执行

- 问题

  - 静态方法（静态符号分析，污点分析）- 缺乏ARM等轻量级架构的支持
  - 模糊测试 - 无法对轻量级固件模拟执行

- ![image-20220925210128554](C:\Users\8208191402\AppData\Roaming\Typora\typora-user-images\image-20220925210128554.png)

### 侧信道分析

> 智能家居在传输用户数据的时候会产生物理现象，因而会产生信道之外的攻击方法

- 设备攻击
  - 破解设备工作产生的物理现象，窃取用户数据
- 网络通讯攻击
  - 分析带宽，流量的变化窃取用户数据
- 

# 网络安全/通信安全

### 协议漏洞挖掘

> 对于常用的Zigbee，BlueTooth协议和MQTT，CoAP协议本身的漏洞

- 物理层漏洞
  - 物体互联和接入网络的问题
  - 常见：Zigbee，蓝牙，WiFi
  - 为了便与设备接入，厂商使用默认链路秘钥，被攻击和窃取数据
  - 通过DOS和去同步攻击来破解轻量级的RFID，绕过密码开锁/窃取数据
- 应用层协议安全漏洞
  - **MQTT是一个即时通信协议**，**CoAP是专门针对受限设备的协议**
  - CoAP可以转换成HTTP与web应用集成
  - 智能家居平台配置和实施协议的时候不规范

### 网络流量分析

> 在网络层对家具进行管理

- 分析网络流量特征和应用设备之间的关系，评估加剧的安全状况。

# 总结

![image-20220925211844836](C:\Users\8208191402\AppData\Roaming\Typora\typora-user-images\image-20220925211844836.png)

## 用户身份认证缺失

>  多用户场景下的，缺乏人机交互设备的，轻量级设备的安全认证

## 访问认证缺陷

> 基于智能手机的权限系统，划分更细粒度的，以组为单位的新的权限访问控制

## 设备联动规则错误

## 设备固件漏洞

> 目前的测试技术缺乏对多元架构固件的支持；设备供应商不公开，难以获取。

## 智能音箱语音识别漏洞

> 深度学习算法的漏洞，包括了语⾳信号处理，特征提取，声学模型处理，语⾔模型处理一系列过程，每个过程都可能出现问题，克服对抗样本和提高模型泛化能力。

## 通信协议安全漏洞

> 对平台的协议进行完善

# 未来方向

## 多用户环境下的认证、访问控制机制

> 在受限资源的设备上，实现类比于数据库系统的用户权限分级，用户建立，权限赋予和撤销

## 设备联动规则错误检测

> 消除资源的访问冲突和可能导致的安全隐患

## 固件漏洞挖掘技术

> 模拟固件执行环境，支持多元化固件的静态分析
